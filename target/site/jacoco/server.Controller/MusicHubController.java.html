<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MusicHubController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ProjetGLPOO</a> &gt; <a href="index.source.html" class="el_package">server.Controller</a> &gt; <span class="el_source">MusicHubController.java</span></div><h1>MusicHubController.java</h1><pre class="source lang-java linenums">package server.Controller;

import Model.*;
import Model.Exceptions.NoAlbumFoundException;
import Model.Exceptions.NoElementFoundException;
import Model.Exceptions.NoPlayListFoundException;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import java.util.*;


<span class="fc" id="L15">class SortByDate implements Comparator&lt;Album&gt;</span>
{
	public int compare(Album a1, Album a2) {
<span class="fc" id="L18">		return a1.getDate().compareTo(a2.getDate());</span>
	}
}

<span class="nc" id="L22">class SortByGenre implements Comparator&lt;Song&gt;</span>
{
	public int compare(Song s1, Song s2) {
<span class="nc" id="L25">		return s1.getGenre().compareTo(s2.getGenre());</span>
	}
}

<span class="nc" id="L29">class SortByAuthor implements Comparator&lt;AudioElement&gt;</span>
{
	public int compare(AudioElement e1, AudioElement e2) {
<span class="nc" id="L32">		return e1.getArtist().compareTo(e2.getArtist());</span>
	}
}

public class MusicHubController {
	private List&lt;Album&gt; albums;
	private List&lt;PlayList&gt; playlists;
	private List&lt;AudioElement&gt; elements;

<span class="fc" id="L41">	public static final String DIR = System.getProperty(&quot;user.dir&quot;);</span>
<span class="fc" id="L42">	public static final String ALBUMS_FILE_PATH = DIR + &quot;\\files\\albums.xml&quot;;</span>
<span class="fc" id="L43">	public static final String PLAYLISTS_FILE_PATH = DIR + &quot;\\files\\playlists.xml&quot;;</span>
<span class="fc" id="L44">	public static final String ELEMENTS_FILE_PATH = DIR + &quot;\\files\\elements.xml&quot;;</span>
	/**
	 * Création d'un objet log pour
	 * l'ecriture des erreurs dans
	 * fichier horodatés
	 */
<span class="fc" id="L50">	Logs logs = new Logs();</span>
<span class="fc" id="L51">	private XMLHandler xmlHandler = new XMLHandler();</span>

<span class="fc" id="L53">	public MusicHubController () {</span>
<span class="fc" id="L54">		albums = new LinkedList&lt;Album&gt;();</span>
<span class="fc" id="L55">		playlists = new LinkedList&lt;PlayList&gt;();</span>
<span class="fc" id="L56">		elements = new LinkedList&lt;AudioElement&gt;();</span>
<span class="fc" id="L57">		this.loadElements();</span>
<span class="fc" id="L58">		this.loadAlbums();</span>
<span class="fc" id="L59">		this.loadPlaylists();</span>
<span class="fc" id="L60">	}</span>

	public void addElement(AudioElement element) {
<span class="fc" id="L63">		elements.add(element);</span>
<span class="fc" id="L64">	}</span>

	public void addAlbum(Album album) {
<span class="fc" id="L67">		albums.add(album);</span>
<span class="fc" id="L68">	}</span>

	public void addPlaylist(PlayList playlist) {
<span class="fc" id="L71">		playlists.add(playlist);</span>
<span class="fc" id="L72">	}</span>

	public void deletePlayList(String playListTitle) throws NoPlayListFoundException {

<span class="fc" id="L76">		PlayList thePlayList = null;</span>
<span class="fc" id="L77">		boolean result = false;</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">		for (PlayList pl : playlists) {</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">			if (pl.getTitle().toLowerCase().equals(playListTitle.toLowerCase())) {</span>
<span class="fc" id="L80">				thePlayList = pl;</span>
<span class="fc" id="L81">				break;</span>
			}
<span class="nc" id="L83">		}</span>

<span class="pc bpc" id="L85" title="1 of 2 branches missed.">		if (thePlayList != null)</span>
<span class="fc" id="L86">			result = playlists.remove(thePlayList);</span>
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">		if (!result) throw new NoPlayListFoundException(&quot;Playlist &quot; + playListTitle + &quot; not found!&quot;);</span>
<span class="fc" id="L88">	}</span>

	public Iterator&lt;Album&gt; albums() {
<span class="fc" id="L91">		return albums.listIterator();</span>
	}

	public Iterator&lt;PlayList&gt; playlists() {
<span class="fc" id="L95">		return playlists.listIterator();</span>
	}

	public Iterator&lt;AudioElement&gt; elements() {
<span class="nc" id="L99">		return elements.listIterator();</span>
	}

	public String getAlbumsTitlesSortedByDate() {
<span class="fc" id="L103">		StringBuffer titleList = new StringBuffer();</span>
<span class="fc" id="L104">		Collections.sort(albums, new SortByDate());</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">		for (Album al : albums)</span>
<span class="fc" id="L106">			titleList.append(al.getTitle()+ &quot;\n&quot;);</span>
<span class="fc" id="L107">		return titleList.toString();</span>
	}

	public String getPlaylistsList(){
<span class="nc" id="L111">		StringBuffer playlist = new StringBuffer();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">		for (PlayList playList:playlists) {</span>
<span class="nc" id="L113">			playlist.append(playList.getTitle()+ &quot;\n&quot;);</span>
<span class="nc" id="L114">		}</span>
<span class="nc" id="L115">		return  playlist.toString();</span>
	}

	public String getAudiobooksTitlesSortedByAuthor() {
<span class="nc" id="L119">		StringBuffer titleList = new StringBuffer();</span>
<span class="nc" id="L120">		List&lt;AudioElement&gt; audioBookList = new ArrayList&lt;AudioElement&gt;();</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">		for (AudioElement ae : elements)</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">			if (ae instanceof AudioBook)</span>
<span class="nc" id="L123">				audioBookList.add(ae);</span>
<span class="nc" id="L124">		Collections.sort(audioBookList, new SortByAuthor());</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">		for (AudioElement ab : audioBookList)</span>
<span class="nc" id="L126">			titleList.append(ab.getArtist()+ &quot;\n&quot;);</span>
<span class="nc" id="L127">		return titleList.toString();</span>
	}

	public List&lt;AudioElement&gt; getAlbumSongs (String albumTitle) throws NoAlbumFoundException {
<span class="nc" id="L131">		Album theAlbum = null;</span>
<span class="nc" id="L132">		ArrayList&lt;AudioElement&gt; songsInAlbum = new ArrayList&lt;AudioElement&gt;();</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">		for (Album al : albums) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			if (al.getTitle().toLowerCase().equals(albumTitle.toLowerCase())) {</span>
<span class="nc" id="L135">				theAlbum = al;</span>
<span class="nc" id="L136">				break;</span>
			}
<span class="nc" id="L138">		}</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (theAlbum == null) throw new NoAlbumFoundException(&quot;No album with this title in the MusicHub!&quot;);</span>

<span class="nc" id="L141">		List&lt;UUID&gt; songIDs = theAlbum.getSongs();</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">		for (UUID id : songIDs)</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">			for (AudioElement el : elements) {</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">				if (el instanceof Song) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">					if (el.getUUID().equals(id)) songsInAlbum.add(el);</span>
				}
<span class="nc" id="L147">			}</span>
<span class="nc" id="L148">		return songsInAlbum;</span>

	}

	public List&lt;Song&gt; getAlbumSongsSortedByGenre (String albumTitle) throws NoAlbumFoundException {
<span class="nc" id="L153">		Album theAlbum = null;</span>
<span class="nc" id="L154">		ArrayList&lt;Song&gt; songsInAlbum = new ArrayList&lt;Song&gt;();</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">		for (Album al : albums) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">			if (al.getTitle().toLowerCase().equals(albumTitle.toLowerCase())) {</span>
<span class="nc" id="L157">				theAlbum = al;</span>
<span class="nc" id="L158">				break;</span>
			}
<span class="nc" id="L160">		}</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">		if (theAlbum == null) throw new NoAlbumFoundException(&quot;No album with this title in the MusicHub!&quot;);</span>

<span class="nc" id="L163">		List&lt;UUID&gt; songIDs = theAlbum.getSongs();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">		for (UUID id : songIDs)</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">			for (AudioElement el : elements) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">				if (el instanceof Song) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">					if (el.getUUID().equals(id)) songsInAlbum.add((Song)el);</span>
				}
<span class="nc" id="L169">			}</span>
<span class="nc" id="L170">		Collections.sort(songsInAlbum, new SortByGenre());</span>
<span class="nc" id="L171">		return songsInAlbum;</span>

	}

	public void addElementToAlbum(String elementTitle, String albumTitle) throws NoAlbumFoundException, NoElementFoundException
	{
<span class="fc" id="L177">		Album theAlbum = null;</span>
<span class="fc" id="L178">		int i = 0;</span>
<span class="fc" id="L179">		boolean found = false;</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">		for (i = 0; i &lt; albums.size(); i++) {</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">			if (albums.get(i).getTitle().toLowerCase().equals(albumTitle.toLowerCase())) {</span>
<span class="nc" id="L182">				theAlbum = albums.get(i);</span>
<span class="nc" id="L183">				found = true;</span>
<span class="nc" id="L184">				break;</span>
			}
		}

<span class="pc bpc" id="L188" title="1 of 2 branches missed.">		if (found == true) {</span>
<span class="nc" id="L189">			AudioElement theElement = null;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">			for (AudioElement ae : elements) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">				if (ae.getTitle().toLowerCase().equals(elementTitle.toLowerCase())) {</span>
<span class="nc" id="L192">					theElement = ae;</span>
<span class="nc" id="L193">					break;</span>
				}
<span class="nc" id="L195">			}</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">			if (theElement != null) {</span>
<span class="nc" id="L197">				theAlbum.addSong(theElement.getUUID());</span>
				//replace the album in the list
<span class="nc" id="L199">				albums.set(i,theAlbum);</span>
			}
<span class="nc" id="L201">			else throw new NoElementFoundException(&quot;Element &quot; + elementTitle + &quot; not found!&quot;);</span>
			/**
			 * logWrite error
			 */
<span class="nc" id="L205">			logs.writeError(&quot;[SERVER]: &quot;+&quot;Element&quot; +elementTitle +&quot;not founf&quot;);</span>

<span class="nc" id="L207">		}</span>
<span class="fc" id="L208">		else throw new NoAlbumFoundException(&quot;Album &quot; + albumTitle + &quot; not found!&quot;);</span>
		/**
		 * logWrite error
		 */
<span class="nc" id="L212">		logs.writeError(&quot;[SERVER]: &quot;+&quot;Album&quot; +albumTitle +&quot;not founf&quot;);</span>
<span class="nc" id="L213">	}</span>

	public void addElementToPlayList(String elementTitle, String playListTitle) throws NoPlayListFoundException, NoElementFoundException
	{
<span class="fc" id="L217">		PlayList thePlaylist = null;</span>
<span class="fc" id="L218">		int i = 0;</span>
<span class="fc" id="L219">		boolean found = false;</span>

<span class="pc bpc" id="L221" title="1 of 2 branches missed.">		for (i = 0; i &lt; playlists.size(); i++) {</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">			if (playlists.get(i).getTitle().toLowerCase().equals(playListTitle.toLowerCase())) {</span>
<span class="fc" id="L223">				thePlaylist = playlists.get(i);</span>
<span class="fc" id="L224">				found = true;</span>
<span class="fc" id="L225">				break;</span>
			}
		}

<span class="pc bpc" id="L229" title="1 of 2 branches missed.">		if (found == true) {</span>
<span class="fc" id="L230">			AudioElement theElement = null;</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">			for (AudioElement ae : elements) {</span>
<span class="pc bpc" id="L232" title="1 of 2 branches missed.">				if (ae.getTitle().toLowerCase().equals(elementTitle.toLowerCase())) {</span>
<span class="fc" id="L233">					theElement = ae;</span>
<span class="fc" id="L234">					break;</span>
				}
<span class="nc" id="L236">			}</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">			if (theElement != null) {</span>
<span class="fc" id="L238">				thePlaylist.addElement(theElement.getUUID());</span>
				//replace the album in the list
<span class="fc" id="L240">				playlists.set(i,thePlaylist);</span>
			}
<span class="nc" id="L242">			else throw new NoElementFoundException(&quot;Element &quot; + elementTitle + &quot; not found!&quot;);</span>

<span class="pc" id="L244">		} else throw new NoPlayListFoundException(&quot;Playlist &quot; + playListTitle + &quot; not found!&quot;);</span>

<span class="fc" id="L246">	}</span>

	private void loadAlbums () {
<span class="fc" id="L249">		NodeList albumNodes = xmlHandler.parseXMLFile(ALBUMS_FILE_PATH);</span>
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">		if (albumNodes == null) return;</span>

<span class="fc bfc" id="L252" title="All 2 branches covered.">		for (int i = 0; i &lt; albumNodes.getLength(); i++) {</span>
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">			if (albumNodes.item(i).getNodeType() == Node.ELEMENT_NODE)   {</span>
<span class="fc" id="L254">				Element albumElement = (Element) albumNodes.item(i);</span>
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">				if (albumElement.getNodeName().equals(&quot;album&quot;)) 	{</span>
					try {
<span class="fc" id="L257">						this.addAlbum(new Album (albumElement));</span>
<span class="nc" id="L258">					} catch (Exception ex) {</span>
						//System.out.println (&quot;Something is wrong with the XML album element&quot;);
						/**
						 * logWrite error
						 */
<span class="nc" id="L263">						logs.writeError(&quot;[SERVER]: &quot;+&quot;omething is wrong with the XML album element&quot;);</span>

<span class="fc" id="L265">					}</span>
				}
			}
		}
<span class="fc" id="L269">	}</span>

	private void loadPlaylists () {
<span class="fc" id="L272">		NodeList playlistNodes = xmlHandler.parseXMLFile(PLAYLISTS_FILE_PATH);</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">		if (playlistNodes == null) return;</span>

<span class="fc bfc" id="L275" title="All 2 branches covered.">		for (int i = 0; i &lt; playlistNodes.getLength(); i++) {</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">			if (playlistNodes.item(i).getNodeType() == Node.ELEMENT_NODE)   {</span>
<span class="fc" id="L277">				Element playlistElement = (Element) playlistNodes.item(i);</span>
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">				if (playlistElement.getNodeName().equals(&quot;playlist&quot;)) 	{</span>
					try {
<span class="fc" id="L280">						this.addPlaylist(new PlayList (playlistElement));</span>
<span class="nc" id="L281">					} catch (Exception ex) {</span>
						//System.out.println (&quot;Something is wrong with the XML playlist element&quot;);
						/**
						 * logWrite error
						 */
<span class="nc" id="L286">						logs.writeError(&quot;[SERVER]: &quot;+&quot;omething is wrong with the XML audiobook element&quot;);</span>

<span class="fc" id="L288">					}</span>
				}
			}
		}
<span class="fc" id="L292">	}</span>

	private void loadElements () {
<span class="fc" id="L295">		NodeList audioelementsNodes = xmlHandler.parseXMLFile(ELEMENTS_FILE_PATH);</span>
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">		if (audioelementsNodes == null) return;</span>

<span class="fc bfc" id="L298" title="All 2 branches covered.">		for (int i = 0; i &lt; audioelementsNodes.getLength(); i++) {</span>
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">			if (audioelementsNodes.item(i).getNodeType() == Node.ELEMENT_NODE)   {</span>
<span class="fc" id="L300">				Element audioElement = (Element) audioelementsNodes.item(i);</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">				if (audioElement.getNodeName().equals(&quot;song&quot;)) 	{</span>
					try {
<span class="fc" id="L303">						AudioElement newSong = new Song (audioElement);</span>
<span class="fc" id="L304">						this.addElement(newSong);</span>
<span class="nc" id="L305">					} catch (Exception ex) 	{</span>
						//System.out.println (&quot;Something is wrong with the XML song element&quot;);
						/**
						 * logWrite erro
						 */
<span class="nc" id="L310">						logs.writeError(&quot;[SERVER]: &quot;+&quot;omething is wrong with the XML song element&quot;);</span>

<span class="fc" id="L312">					}</span>
				}
<span class="fc bfc" id="L314" title="All 2 branches covered.">				if (audioElement.getNodeName().equals(&quot;audiobook&quot;)) 	{</span>
					try {
<span class="fc" id="L316">						AudioElement newAudioBook = new AudioBook (audioElement);</span>
<span class="fc" id="L317">						this.addElement(newAudioBook);</span>
<span class="nc" id="L318">					} catch (Exception ex) 	{</span>
						//System.out.println (&quot;Something is wrong with the XML audiobook element&quot;);
						/**
						 * logWrite error
						 */
<span class="nc" id="L323">						logs.writeError(&quot;[SERVER]: &quot;+&quot;something is wrong with the XML audiobook element&quot;);</span>
<span class="fc" id="L324">					}</span>
				}
			}
		}
<span class="fc" id="L328">	}</span>


	public void saveAlbums () {
<span class="fc" id="L332">		Document document = xmlHandler.createXMLDocument();</span>
<span class="pc bpc" id="L333" title="1 of 2 branches missed.">		if (document == null) return;</span>

		// root element
<span class="fc" id="L336">		Element root = document.createElement(&quot;albums&quot;);</span>
<span class="fc" id="L337">		document.appendChild(root);</span>

		//save all albums
<span class="fc bfc" id="L340" title="All 2 branches covered.">		for (Iterator&lt;Album&gt; albumsIter = this.albums(); albumsIter.hasNext();) {</span>
<span class="fc" id="L341">			Album currentAlbum = albumsIter.next();</span>
<span class="fc" id="L342">			currentAlbum.createXMLElement(document, root);</span>
<span class="fc" id="L343">		}</span>
<span class="fc" id="L344">		xmlHandler.createXMLFile(document, ALBUMS_FILE_PATH);</span>
<span class="fc" id="L345">	}</span>

	public void savePlayLists () {
<span class="fc" id="L348">		Document document = xmlHandler.createXMLDocument();</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">		if (document == null) return;</span>

		// root element
<span class="fc" id="L352">		Element root = document.createElement(&quot;playlists&quot;);</span>
<span class="fc" id="L353">		document.appendChild(root);</span>

		//save all playlists
<span class="fc bfc" id="L356" title="All 2 branches covered.">		for (Iterator&lt;PlayList&gt; playlistsIter = this.playlists(); playlistsIter.hasNext();) {</span>
<span class="fc" id="L357">			PlayList currentPlayList = playlistsIter.next();</span>
<span class="fc" id="L358">			currentPlayList.createXMLElement(document, root);</span>
<span class="fc" id="L359">		}</span>
<span class="fc" id="L360">		xmlHandler.createXMLFile(document, PLAYLISTS_FILE_PATH);</span>
<span class="fc" id="L361">	}</span>

	public void saveElements() {
<span class="fc" id="L364">		Document document = xmlHandler.createXMLDocument();</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">		if (document == null) return;</span>

		// root element
<span class="fc" id="L368">		Element root = document.createElement(&quot;elements&quot;);</span>
<span class="fc" id="L369">		document.appendChild(root);</span>

		//save all AudioElements
<span class="fc" id="L372">		Iterator&lt;AudioElement&gt; elementsIter = elements.listIterator();</span>
<span class="fc bfc" id="L373" title="All 2 branches covered.">		while (elementsIter.hasNext()) {</span>

<span class="fc" id="L375">			AudioElement currentElement = elementsIter.next();</span>
<span class="fc bfc" id="L376" title="All 2 branches covered.">			if (currentElement instanceof Song)</span>
			{
<span class="fc" id="L378">				((Song)currentElement).createXMLElement(document, root);</span>
			}
<span class="fc bfc" id="L380" title="All 2 branches covered.">			if (currentElement instanceof AudioBook)</span>
			{
<span class="fc" id="L382">				((AudioBook)currentElement).createXMLElement(document, root);</span>
			}
<span class="fc" id="L384">		}</span>
<span class="fc" id="L385">		xmlHandler.createXMLFile(document, ELEMENTS_FILE_PATH);</span>
<span class="fc" id="L386">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>